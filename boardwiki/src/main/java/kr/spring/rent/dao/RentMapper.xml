<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.spring.rent.dao.RentMapper">
    <insert id="insertRent">
        INSERT INTO game_rent (rent_num, rent_sdate, rent_edate, rent_period, mem_num, item_num)
        VALUES (game_rent_seq.nextval, #{rentSdate}, #{rentEdate}, #{rentPeriod}, #{memNum}, #{itemNum})
    </insert>

	 <!-- 대여 전체 목록/검색 목록 -->
    <select id="selectRentList" parameterType="map" resultType="kr.spring.rent.vo.RentVO">
        SELECT * FROM game_rent
    </select>
    
    <!-- sql 태그와 include 태그를 이용해서 SQL문을 재사용 -->
	 <sql id="boardSearch">
	 	<where>
	 		<if test="keyword !=null and keyword != ''">
	 			<if test="category !=null and category != ''">
		 			AND 
		 		</if>
		 		<if test="keyfield == 1">
		 			title LIKE '%' || #{keyword} || '%'
		 		</if>
		 		<if test="keyfield == 2">
		 			(id LIKE '%' || #{keyword} || '%' OR
		 			nick_name LIKE '%' || #{keyword} || '%')
		 		</if>
		 		<if test="keyfield == 3">
		 			content LIKE '%' || #{keyword} || '%'
		 		</if>
		 		<if test="keyfield == 4">
		 			(title LIKE '%' || #{keyword} || '%' OR
		 			content LIKE '%' || #{keyword} || '%')
		 		</if>
	 		</if>
	 	</where>
	 </sql>
	 
	 <!-- <sql id="boardOrder">
	 	<if test="order == 1">
	 		ORDER BY board_num DESC
	 	</if>
	 	<if test="order == 2">
	 		ORDER BY hit DESC
	 	</if>
	 	<if test="order == 3">
	 		ORDER BY fav_cnt DESC NULLS LAST
	 	</if>
	 	<if test="order == 4">
	 		ORDER BY re_cnt DESC NULLS LAST
	 	</if>
	 </sql> -->
    

	<!-- 대여 목록 총 레코드수/검색 레코드수 -->
	 <select id="selectRowCount" parameterType="map"
	                                resultType="integer">
	 	SELECT
	 	   COUNT(*)
	 	FROM game_rent JOIN member USING (mem_num)
	 	<include refid="boardSearch"></include>
	 </select>

    <update id="updateRent">
        UPDATE game_rent
        SET rent_sdate = #{rentSdate},
            rent_edate = #{rentEdate},
            rent_period = #{rentPeriod},
            mem_num = #{memNum},
            item_num = #{itemNum}
        WHERE rent_num = #{rentNum}
    </update>
</mapper>
