<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.board.dao.BoardMapper"> 
	 <!-- 글쓰기 -->
	 <insert id="insertBoard" parameterType="boardVO">
	 	INSERT INTO board(
	 	  boa_num,
	 	  boa_category,
	 	  boa_title,
	 	  boa_content,
	 	  boa_file,
	 	  mem_num)
	 	VALUES(
	 	  board_seq.nextval,
	 	  #{boa_category},
	 	  #{boa_title},
	 	  #{boa_content},
	 	  #{boa_file,jdbcType=VARCHAR},
	 	  #{mem_num})
	 </insert>
	 <!-- sql 태그와 include 태그를 이용해서 SQL문을 재사용 -->
	 <sql id="boardSearch">
	 	<where>
	 		<if test="category !=null and category != ''">
	 			boa_category = #{boa_category}
	 		</if>
	 		<if test="keyword !=null and keyword != ''">
	 			<if test="category !=null and category != ''">
	 				AND
	 			</if>
	 		</if>
	 		<if test="keyfield == 1">
	 			boa_title LIKE '%' || #{keyword} || '%'
	 		</if>
	 		<if test="keyfield == 2">
	 			(id LIKE '%' || #{keyword} || '%' OR
	 			nick_name LIKE '%' || #{keyword} || '%')
	 		</if>
	 		<if test="keyfield == 3">
	 			boa_content LIKE '%' || #{keyword} || '%'
	 		</if>
	 		<if test="keyfield == 4">
	 			(boa_title LIKE '%' || #{keyword} || '%' OR
	 			boa_content LIKE '%' || #{keyword} || '%')
	 		</if>
	 	</where>
	 </sql>
	 
	 <sql id="boardOrder">
 		<if test="order == 1">
 			ORDER BY boa_num DESC
 		</if>
 		<if test="order == 2">
 			ORDER BY boa_hit DESC
 		</if>
 		<if test="order == 3">
 			ORDER BY fav_cnt DESC NULLS LAST
 		</if>
 		<if test="order == 4">
 			ORDER BY re_cnt DESC NULLS LAST
 		</if>
	 </sql>
	 
	 <!-- 게시판 글 총레코드수/검색레코드수 -->
	 <select id="selectRowCount" parameterType="map"
									resultType="integer">
		SELECT
			COUNT(*)
		FROM board JOIN member USING (mem_num)
		<include refid="boardSearch"></include>	 
	 </select>
	 <!-- 게시판 전체 목록/검색 목록 -->
	 <select id="selectList" parameterType="map"
	 							resultType="boardVO">
	 	SELECT
	 	   *
	 	FROM (SELECT
	 			a.*,
	 			rownum rnum
	 		   FROM (SELECT
	 		   			*
	 		   		 FROM board
	 		   		 LEFT OUTER JOIN (SELECT COUNT(*) fav_cnt, boa_num FROM board_fav GROUP BY boa_num) USING(boa_num)
	 		   		 JOIN member USING(mem_num)
	 		   		 <include refid="boardSearch"></include>
	 		   		 <include refid="boardOrder"></include>
	 		   		 )a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	<!-- 게시판 글 수정 -->
	
	<!-- 댓글 등록 -->
	<!-- 댓글 목록 -->
 </mapper>



















